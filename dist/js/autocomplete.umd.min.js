/*!
* @name autocomplete
* @version 2.0.2
* @author Grzegorz Tomicki
* @link https://github.com/tomickigrzegorz/autocomplete
* @license MIT
*/
!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Autocomplete=s()}(this,(function(){"use strict";const t=(t,s)=>{for(let i in s)"addClass"===i?e(t,"add",s[i]):"removeClass"===i?e(t,"remove",s[i]):t.setAttribute(i,s[i])},s=t=>(t.firstElementChild||t).textContent.trim(),i=(t,s)=>{t.scrollTop=t.offsetTop-s.offsetHeight},h=function(t,s){void 0===t&&(t=!1),t&&(e(t,"remove","hidden"),r(t,"click",s))},e=(t,s,i)=>t.classList[s](i),n=(s,i)=>{t(s,{"aria-activedescendant":i||""})},a=(t,s,i,h)=>{const e=h.previousSibling,n=e?e.offsetHeight:0;if("0"==t.getAttribute("aria-posinset")&&(h.scrollTop=t.offsetTop-((t,s)=>{const i=document.querySelectorAll(`#${t} > li:not(.${s})`);let h=0;return[].slice.call(i).map((t=>h+=t.offsetHeight)),h})(s,i)),t.offsetTop-n<h.scrollTop)h.scrollTop=t.offsetTop-n;else{const s=t.offsetTop+t.offsetHeight-n;s>h.scrollTop+h.offsetHeight&&(h.scrollTop=s-h.offsetHeight)}},o=t=>document.createElement(t),l=t=>document.querySelector(t),r=(t,s,i)=>{t.addEventListener(s,i)},c=(t,s,i)=>{t.removeEventListener(s,i)},d=t=>({"aria-owns":t,"aria-expanded":"false","aria-autocomplete":"list",role:"combobox",removeClass:"auto-expanded"}),u=27,m=13,p=38,f=40,$=9;return class{constructor(v,b){let{delay:x=500,clearButton:y=!0,clearButtonOnInitial:C=!1,howManyCharacters:k=1,selectFirst:g=!1,insertToInput:j=!1,showValuesOnClick:w=!1,inline:V=!1,cache:I=!1,disableCloseOnSelect:O=!1,preventScrollUp:S=!1,removeResultsWhenInputIsEmpty:R=!1,regex:T={expression:/[|\\{}()[\]^$+*?]/g,replacement:"\\$&"},classGroup:B,classPreventClosing:P,classPrefix:A,ariaLabelClear:E,onSearch:G,onResults:J=(()=>{}),onSubmit:N=(()=>{}),onOpened:q=(()=>{}),onReset:z=(()=>{}),onRender:F=(()=>{}),onClose:L=(()=>{}),noResults:M=(()=>{}),onSelectedItem:U=(()=>{})}=b;var W;this.t=()=>{this.i();const s=d(this.h);var i,e,n,a,o;if(t(this.o,s),i=this.o,e=this.l,n=this.h,a=this.u,o=this.m,t(e,{id:n,tabIndex:"0",role:"listbox"}),t(a,{addClass:`${o}-results-wrapper`}),a.insertAdjacentElement("beforeend",e),i.parentNode.insertBefore(a,i.nextSibling),r(this.o,"input",this.p),this.$&&r(this.o,"click",this.p),this.v){const t={root:this.o,type:"load"};r(this.o,"load",this.p(t))}this.C({element:this.o,results:this.l}),this.k&&h(this.j,this.destroy)},this.V=(t,s)=>{this.I&&("update"===t?this.o.setAttribute(this.O,s?.value):"remove"===t?this.o.removeAttribute(this.O):this.o.value=this.o.getAttribute(this.O))},this.p=t=>{let{target:s,type:i}=t;if("true"===this.o.getAttribute("aria-expanded")&&"click"===i)return;s=this.v?this.o:s;const h=s?.value.replace(this.S.expression,this.S.replacement);this.V("update",s);const e=this.$||this.v&&"load"===i?0:this.R;clearTimeout(this.T),this.T=setTimeout((()=>{this.B&&0===s?.value.length?this.destroy():this.P(h?.trim())}),e)},this.A=()=>{e(this.u,"remove",this.G);const s=d(this.h),i=this.J?s:{...s,"aria-activedescendant":""};t(this.o,i),this.J||(this.N(l(`.${this.q}`)),this.F=this.L?0:-1),(0==this.M?.length&&!this.U||this.$)&&(this.l.textContent=""),this.W()},this.P=t=>{this.D=t,this.H(!0),h(this.j,this.destroy),t&&0!==t?.length||!this.K||this.k||e(this.j,"add","hidden"),this.X>t?.length&&!this.$&&!this.v?this.H():this.Y({currentValue:t,element:this.o}).then((s=>{const i=this.o.value.length,h=s.length;this.M=Array.isArray(s)?s:JSON.parse(JSON.stringify(s)),this.H(),this.Z(),0===h&&0===i&&e(this.j,"add","hidden"),0===h&&i?(e(this.o,"remove","auto-expanded"),this.A(),this._({element:this.o,currentValue:t,template:this.tt}),this.st()):(h>0||(t=>t&&"object"==typeof t&&t.constructor===Object)(s))&&(this.F=this.L?0:-1,this.tt(),this.st())})).catch((()=>{this.H(),this.A()}))},this.H=t=>this.o.parentNode.classList[t?"add":"remove"](this.it),this.Z=()=>e(this.o,"remove",this.ht),this.st=()=>{r(this.o,"keydown",this.et),r(this.o,"click",this.nt),this.v||r(document,"click",this.ot),["mousemove","click"].map((t=>{r(this.l,t,this.lt)}))},this.tt=s=>{t(this.o,{"aria-expanded":"true",addClass:`${this.m}-expanded`}),this.l.textContent="";const h=0===this.M.length?this.rt({currentValue:this.D,matches:0,template:s}):this.rt({currentValue:this.D,matches:this.M,classGroup:this.ct});this.l.insertAdjacentHTML("afterbegin",h),e(this.u,"add",this.G);const n=this.ct?`:not(.${this.ct})`:"";this.dt=document.querySelectorAll(`#${this.h} > li${n}`),(s=>{for(let i=0;i<s.length;i++)t(s[i],{role:"option",tabindex:"-1","aria-selected":"false","aria-setsize":s.length,"aria-posinset":i+1})})(this.dt),this.ut({type:"results",element:this.o,results:this.l}),this.ft(),i(this.l,this.u)},this.ot=t=>{let{target:s}=t,i=null;(s.closest("ul")&&this.$t||s.closest(`.${this.vt}`))&&(i=!0),s.id===this.bt||i||this.A()},this.ft=()=>{if(this.N(l(`.${this.q}`)),!this.L)return;const{firstElementChild:s}=this.l,i=this.ct&&this.M.length>0&&this.L?s.nextElementSibling:s;this.xt({index:this.F,element:this.o,object:this.M[this.F],currentValue:this.o.value}),t(i,{id:`${this.yt}-0`,addClass:this.q,"aria-selected":"true"}),n(this.o,`${this.yt}-0`)},this.nt=()=>{if(this.l.textContent.length>0&&!e(this.u,"contains",this.G)){if(t(this.o,{"aria-expanded":"true",addClass:`${this.m}-expanded`}),e(this.u,"add",this.G),this.J||(i(this.l,this.u),this.ft()),this.ut({type:"showItems",element:this.o,results:this.l}),!this.I)return;this.V("update",this.o)}},this.lt=t=>{t.preventDefault();const{target:s,type:i}=t,h=s.closest("li"),n=h?.hasAttribute("role"),a=this.q,o=l(`.${a}`);h&&n&&!s.closest(`.${this.vt}`)&&("click"===i&&this.Ct(h),"mousemove"!==i||e(h,"contains",a)||(this.N(o),this.kt(h),this.F=this.gt(h),this.xt({index:this.F,element:this.o,object:this.M[this.F]}),this.o.value.length>0&&this.K&&e(this.j,"remove","hidden")))},this.Ct=t=>{t&&0!==this.M.length?(this.K&&e(this.j,"remove","hidden"),this.o.value=s(t),this.jt({index:this.F,element:this.o,object:this.M[this.F],results:this.l}),this.$t||(this.J||this.N(t),this.A()),this.V("remove")):!this.$t&&this.A()},this.gt=t=>Array.prototype.indexOf.call(this.dt,t),this.et=t=>{const{keyCode:i}=t,h=e(this.u,"contains",this.G),a=this.M.length+1;switch(this.wt=l(`.${this.q}`),i){case p:case f:if(t.preventDefault(),a<=1&&this.L||!h)return;if(i===p?(this.F<0&&(this.F=a-1),this.F-=1):(this.F+=1,this.F>=a&&(this.F=0)),this.N(this.wt),this.F>=0&&this.F<a-1){const t=this.dt[this.F];this.U&&h&&(this.o.value=s(t),this.K&&e(this.j,"remove","hidden")),this.xt({index:this.F,element:this.o,object:this.M[this.F]}),this.kt(t)}else this.V(),n(this.o),this.xt({index:null,element:this.o,object:null});break;case m:t.preventDefault(),this.Ct(this.wt);break;case $:case u:t.stopPropagation(),this.v||this.A()}},this.kt=s=>{const i=`${this.yt}-${this.gt(s)}`;t(s,{id:i,"aria-selected":"true",addClass:this.q}),n(this.o,i),a(s,this.h,this.ct,this.l)},this.N=s=>{s&&t(s,{id:"",removeClass:this.q,"aria-selected":"false"})},this.i=()=>{this.K&&(t(this.j,{class:`${this.m}-clear hidden`,title:this.Vt,"aria-label":this.Vt}),this.o.insertAdjacentElement("afterend",this.j))},this.rerender=t=>{const s=t?.trim()?t.trim():this.o.value;t?.trim()&&(this.o.value=t.trim(),this.V("update",this.o));const i=s.replace(this.S.expression,this.S.replacement);this.P(i.trim())},this.destroy=()=>{this.K&&e(this.j,"add","hidden"),this.o.value="",this.o.focus(),this.l.textContent="",this.v||this.A(),this.v&&this.W(),this.Z(),this.It(this.o),this.H(),c(this.o,"keydown",this.et),c(this.o,"click",this.nt),c(document,"click",this.ot)},this.bt=v,this.o=document.getElementById(v),this.Y=(W=G,Boolean(W&&"function"==typeof W.then)?G:t=>{let{currentValue:s,element:i}=t;return Promise.resolve(G({currentValue:s,element:i}))}),this.rt=J,this.C=F,this.jt=N,this.xt=U,this.ut=q,this.It=z,this._=M,this.W=L,this.R=x,this.X=k,this.K=y,this.k=C,this.L=g,this.U=j,this.$=w,this.v=V,this.ct=B,this.vt=P,this.Vt=E||"clear the search query",this.m=A?`${A}-auto`:"auto",this.$t=O,this.J=S,this.B=R,this.I=I,this.T=null,this.h=`${this.m}-${this.bt}-results`,this.O=`data-cache-auto-${this.bt}`,this.it=`${this.m}-is-loading`,this.G=`${this.m}-is-active`,this.q=`${this.m}-selected`,this.yt=`${this.m}-selected-option`,this.ht=`${this.m}-error`,this.u=o("div"),this.l=o("ul"),this.j=o("button"),this.S=T,this.Ot={expression:/[|\\{}()[\]^$+*?]/g,replacement:"\\$&"},this.S.replacement||(this.S.replacement=this.Ot.replacement),this.S.expression||(this.S.expression=this.Ot.expression),this.t()}}}));
