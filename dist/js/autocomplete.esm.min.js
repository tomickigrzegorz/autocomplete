/*!
* @name autocomplete
* @version 3.0.0
* @author Grzegorz Tomicki
* @link https://github.com/tomickigrzegorz/autocomplete
* @license MIT
*/
const t=(t,s)=>{Object.entries(s).forEach((([s,i])=>{"addClass"===s||"removeClass"===s?e(t,"addClass"===s?"add":"remove",i):t.setAttribute(s,i)}))},s=t=>(t.firstElementChild||t).textContent.trim(),i=(t,s)=>{t.scrollTop=t.offsetTop-s.offsetHeight},h=(t,s)=>{t&&(e(t,"remove","hidden"),l(t,"click",s))},e=(t,s,i)=>t.classList[s](i),a=(s,i)=>{t(s,{"aria-activedescendant":i||""})},n=(t,s,i,h)=>{const e=h.previousSibling,a=e?e.offsetHeight:0;if("0"===t.getAttribute("aria-posinset")&&(h.scrollTop=t.offsetTop-((t,s)=>{const i=document.querySelectorAll(`#${t} > li:not(.${s})`);return Array.from(i).reduce(((t,s)=>t+s.offsetHeight),0)})(s,i)),t.offsetTop-a<h.scrollTop)h.scrollTop=t.offsetTop-a;else{const s=t.offsetTop+t.offsetHeight-a;s>h.scrollTop+h.offsetHeight&&(h.scrollTop=s-h.offsetHeight)}},o=t=>document.createElement(t),r=t=>document.querySelector(t),l=(t,s,i)=>{t.addEventListener(s,i)},c=(t,s,i)=>{t.removeEventListener(s,i)},d=t=>({"aria-owns":t,"aria-expanded":"false","aria-autocomplete":"list",role:"combobox",removeClass:"auto-expanded"}),u=Object.freeze({ESC:27,ENTER:13,UP:38,DOWN:40,TAB:9});class m{constructor(m,{delay:p=500,clearButton:$=!0,clearButtonOnInitial:v=!1,howManyCharacters:b=1,selectFirst:x=!1,insertToInput:f=!1,showValuesOnClick:C=!1,inline:y=!1,cache:k=!1,disableCloseOnSelect:O=!1,preventScrollUp:g=!1,removeResultsWhenInputIsEmpty:j=!1,regex:w={expression:/[|\\{}()[\]^$+*?]/g,replacement:"\\$&"},classGroup:S,classPreventClosing:V,classPrefix:I,ariaLabelClear:R,onSearch:E,onResults:T=(()=>{}),onSubmit:A=(()=>{}),onOpened:B=(()=>{}),onReset:N=(()=>{}),onRender:P=(()=>{}),onClose:G=(()=>{}),noResults:J=(()=>{}),onSelectedItem:U=(()=>{})}){var W;this.t=()=>{this.i();const s=d(this.h);var i,e,a,n,o;if(t(this.o,s),i=this.o,e=this.l,a=this.h,n=this.u,o=this.m,t(e,{id:a,role:"listbox"}),t(n,{addClass:`${o}-results-wrapper`}),n.insertAdjacentElement("beforeend",e),i.parentNode.insertBefore(n,i.nextSibling),l(this.o,"input",this.p),this.$&&l(this.o,"click",this.p),this.v){const t={root:this.o,type:"load"};l(this.o,"load",this.p(t))}this.C({element:this.o,results:this.l}),this.k&&h(this.O,this.destroy)},this.j=(t,s)=>{this.S&&("update"===t?this.o.setAttribute(this.V,s?.value):"remove"===t?this.o.removeAttribute(this.V):this.o.value=this.o.getAttribute(this.V))},this.p=({target:t,type:s})=>{if("true"===this.o.getAttribute("aria-expanded")&&"click"===s)return;t=this.v?this.o:t;const i=t?.value.replace(this.I.expression,this.I.replacement);this.j("update",t);const h=this.$||this.v&&"load"===s?0:this.R;clearTimeout(this.T),this.T=setTimeout((()=>{this.A&&0===t?.value.length?this.destroy():this.B(i?.trim())}),h)},this.N=()=>{e(this.u,"remove",this.P);const s=d(this.h),i=this.G?s:{...s,"aria-activedescendant":""};t(this.o,i),this.G||(this.J(r(`.${this.U}`)),this.W=this.q?0:-1),(0==this.D?.length&&!this.F||this.$)&&(this.l.textContent=""),this.L()},this.B=t=>{this.M=t,this.H(!0),h(this.O,this.destroy),t&&0!==t?.length||!this.K||this.k||e(this.O,"add","hidden"),this.X>t?.length&&!this.$&&!this.v?this.H():this.Y({currentValue:t,element:this.o}).then((s=>{const i=this.o.value.length,h=s.length;this.D=Array.isArray(s)?s:JSON.parse(JSON.stringify(s)),this.H(),this.Z(),0===h&&0===i&&e(this.O,"add","hidden"),0===h&&i?(e(this.o,"remove","auto-expanded"),this.N(),this._({element:this.o,currentValue:t,template:this.tt}),this.st()):(h>0||(t=>t&&"object"==typeof t&&t.constructor===Object)(s))&&(this.W=this.q?0:-1,this.tt(),this.st())})).catch((()=>{this.H(),this.N()}))},this.H=t=>this.o.parentNode.classList[t?"add":"remove"](this.it),this.Z=()=>e(this.o,"remove",this.ht),this.st=()=>{l(this.o,"keydown",this.et),l(this.o,"click",this.nt),this.v||l(document,"click",this.ot),["mousemove","click"].map((t=>{l(this.l,t,this.rt)}))},this.tt=s=>{t(this.o,{"aria-expanded":"true",addClass:`${this.m}-expanded`}),this.l.textContent="";const h=0===this.D.length?this.lt({currentValue:this.M,matches:0,template:s}):this.lt({currentValue:this.M,matches:this.D,classGroup:this.ct});this.l.insertAdjacentHTML("afterbegin",h),e(this.u,"add",this.P);const a=this.ct?`:not(.${this.ct})`:"";var n;this.dt=document.querySelectorAll(`#${this.h} > li${a}`),(n=this.dt).forEach(((s,i)=>{t(s,{role:"option",tabindex:"-1","aria-selected":"false","aria-setsize":n.length,"aria-posinset":i+1})})),this.ut({type:"results",element:this.o,results:this.l}),this.$t(),i(this.l,this.u)},this.ot=({target:t})=>{let s=null;(t.closest("ul")&&this.vt||t.closest(`.${this.bt}`))&&(s=!0),t.id===this.xt||s||this.N()},this.$t=()=>{if(this.J(r(`.${this.U}`)),!this.q)return;const{firstElementChild:s}=this.l,i=this.ct&&this.D.length>0&&this.q?s.nextElementSibling:s;this.ft({index:this.W,element:this.o,object:this.D[this.W],currentValue:this.o.value}),t(i,{id:`${this.Ct}-0`,addClass:this.U,"aria-selected":"true"}),a(this.o,`${this.Ct}-0`)},this.nt=()=>{if(this.l.textContent.length>0&&!e(this.u,"contains",this.P)){if(t(this.o,{"aria-expanded":"true",addClass:`${this.m}-expanded`}),e(this.u,"add",this.P),this.G||(i(this.l,this.u),this.$t()),this.ut({type:"showItems",element:this.o,results:this.l}),!this.S)return;this.j("update",this.o)}},this.rt=t=>{t.preventDefault();const{target:s,type:i}=t,h=s.closest("li"),a=h?.hasAttribute("role"),n=this.U,o=r(`.${n}`);h&&a&&!s.closest(`.${this.bt}`)&&("click"===i&&this.yt(h),"mousemove"!==i||e(h,"contains",n)||(this.J(o),this.kt(h),this.W=this.Ot(h),this.ft({index:this.W,element:this.o,object:this.D[this.W]}),this.o.value.length>0&&this.K&&e(this.O,"remove","hidden")))},this.yt=t=>{t&&0!==this.D.length?(this.K&&e(this.O,"remove","hidden"),this.o.value=s(t),this.gt({index:this.W,element:this.o,object:this.D[this.W],results:this.l}),this.vt||(this.G||this.J(t),this.N()),this.j("remove")):!this.vt&&this.N()},this.Ot=t=>Array.prototype.indexOf.call(this.dt,t),this.et=t=>{const{keyCode:i}=t,h=e(this.u,"contains",this.P),n=this.D.length+1;switch(this.jt=r(`.${this.U}`),i){case u.UP:case u.DOWN:if(t.preventDefault(),n<=1&&this.q||!h)return;if(i===u.UP?(this.W<0&&(this.W=n-1),this.W-=1):(this.W+=1,this.W>=n&&(this.W=0)),this.J(this.jt),this.W>=0&&this.W<n-1){const t=this.dt[this.W];this.F&&h&&(this.o.value=s(t),this.K&&e(this.O,"remove","hidden")),this.ft({index:this.W,element:this.o,object:this.D[this.W]}),this.kt(t)}else this.j(),a(this.o),this.ft({index:null,element:this.o,object:null});break;case u.ENTER:t.preventDefault(),this.yt(this.jt);break;case u.TAB:case u.ESC:t.stopPropagation(),this.v||this.N()}},this.kt=s=>{const i=`${this.Ct}-${this.Ot(s)}`;t(s,{id:i,"aria-selected":"true",addClass:this.U}),a(this.o,i),n(s,this.h,this.ct,this.l)},this.J=s=>{s&&t(s,{id:"",removeClass:this.U,"aria-selected":"false"})},this.i=()=>{this.K&&(t(this.O,{type:"button",class:`${this.m}-clear hidden`,title:this.wt,"aria-label":this.wt}),this.o.insertAdjacentElement("afterend",this.O))},this.rerender=t=>{const s=t?.trim()?t.trim():this.o.value;t?.trim()&&(this.o.value=t.trim(),this.j("update",this.o));const i=s.replace(this.I.expression,this.I.replacement);this.B(i.trim())},this.destroy=()=>{this.K&&e(this.O,"add","hidden"),this.o.value="",this.o.focus(),this.l.textContent="",this.v||this.N(),this.v&&this.L(),this.Z(),this.St(this.o),this.H(),c(this.o,"keydown",this.et),c(this.o,"click",this.nt),c(document,"click",this.ot)},this.xt=m,this.o=document.getElementById(m),this.Y=(W=E,Boolean(W&&"function"==typeof W.then)?E:({currentValue:t,element:s})=>Promise.resolve(E({currentValue:t,element:s}))),this.lt=T,this.C=P,this.gt=A,this.ft=U,this.ut=B,this.St=N,this._=J,this.L=G,this.R=p,this.X=b,this.K=$,this.k=v,this.q=x,this.F=f,this.$=C,this.v=y,this.ct=S,this.bt=V,this.wt=R||"clear the search query",this.m=I?`${I}-auto`:"auto",this.vt=O,this.G=g,this.A=j,this.S=k,this.T=null,this.h=`${this.m}-${this.xt}-results`,this.V=`data-cache-auto-${this.xt}`,this.it=`${this.m}-is-loading`,this.P=`${this.m}-is-active`,this.U=`${this.m}-selected`,this.Ct=`${this.m}-selected-option`,this.ht=`${this.m}-error`,this.u=o("div"),this.l=o("ul"),this.O=o("button"),this.I={expression:/[|\\{}()[\]^$+*?]/g,replacement:"\\$&",...w},this.I.replacement||(this.I.replacement=this.Vt.replacement),this.I.expression||(this.I.expression=this.Vt.expression),this.t()}}export{m as default};
